!function(e){function t(r){if(i[r])return i[r].exports;var o=i[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r=window.webpackJsonp;window.webpackJsonp=function(i,s){for(var n,a,l=0,c=[];l<i.length;l++)a=i[l],o[a]&&c.push.apply(c,o[a]),o[a]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);for(r&&r(i,s);c.length;)c.shift().call(null,t)};var i={},o={8:0,3:0,13:0};return t.e=function(e,r){if(0===o[e])return r.call(null,t);if(void 0!==o[e])o[e].push(r);else{o[e]=[r];var i=document.getElementsByTagName("head")[0],s=document.createElement("script");s.type="text/javascript",s.charset="utf-8",s.async=!0,s.src=t.p+""+e+"."+({}[e]||e)+".js",i.appendChild(s)}},t.m=e,t.c=i,t.p="/",t(0)}([function(e,t,r){"use strict";r(42);var i=r(14),o=(new i,r(30));new o({elem:document.getElementById("image"),isLogged:window.isLogged,preloadEntityCount:1})},,,,,,,,,,,,,,function(e,t,r){"use strict";var i=function(e){var t=this;document.addEventListener("error",function(e){var r=e.detail;t.call(r)})};i.prototype.call=function(e){r.e(1,function(t){var i=r(15).ComponentError,o=r(16);if(!(e instanceof i))throw e;if(401===e.status)localStorage.setItem("redirected_url",window.location.href),window.location="/authorization";else{var s=new o({message:e.message});s.activate()}})},e.exports=i},function(e,t){"use strict";function r(e){this.name="CustomError",this.message=e,Error.captureStackTrace?Error.captureStackTrace(this,r):this.stack=Error().stack}function i(e,t){r.call(this,e||"An error has occurred"),this.name="ComponentError",this.status=t}function o(e,t,r){i.call(this,e||"An error has occurred. Check if javascript is enabled",r),this.name="ClientError",this.detail=t}function s(e){o.call(this,e||"Image not found. It probably has been removed",null,404),this.name="ImageNotFound"}function n(e,t){i.call(this,e||"There is some error on the server side",t),this.name="ServerError"}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,i.prototype=Object.create(r.prototype),i.prototype.constructor=i,o.prototype=Object.create(i.prototype),o.prototype.constructor=o,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,n.prototype=Object.create(i.prototype),n.prototype.constructor=n,e.exports={ComponentError:i,ClientError:o,ImageNotFound:s,ServerError:n}},,function(e,t,r){"use strict";var i=r(18),o=r(19),s=function e(t){this.active=!1,this.listeners=[],this.status=t&&t.status||e.statuses.MINOR};s.statuses={MAJOR:1,MINOR:2},s.prototype.onElemClick=function(e){e.target.matches(".modal-close-button")&&this.deactivate()},s.prototype.setListeners=function(){var e=this;this.listeners.forEach(function(t){e.elem.addEventListener(t.eventName,t.cb)})},s.setBackdrop=function(e){e===s.statuses.MINOR?(s.minorBackdrop=document.getElementById("backdrop_minor"),s.minorBackdrop||(s.minorBackdrop=s.renderBackdrop("minor"))):(s.majorBackdrop=document.getElementById("backdrop_major"),s.majorBackdrop||(s.majorBackdrop=s.renderBackdrop("major")))},s.setWrapper=function(e){e===s.statuses.MINOR?(s.minorWrapper=document.getElementById("modal-wrapper-minor"),s.minorWrapper||(s.minorWrapper=s.renderWrapper("minor")),s.minorWrapper.onclick=function(e){e.target&&!e.target.classList.contains("modal-wrapper_minor")||s.minorActive&&s.minorQueue[0].deactivate()}):(s.majorWrapper=document.getElementById("modal-wrapper-major"),s.majorWrapper||(s.majorWrapper=s.renderWrapper("major")),s.majorWrapper.onclick=function(e){e.target&&!e.target.classList.contains("modal-wrapper_major")||s.majorActive&&s.majorQueue[0].deactivate()})},s.renderBackdrop=function(e){var t=document.createElement("DIV");return t.className="backdrop backdrop_invisible",t.classList.add("backdrop_"+e),t.id="backdrop-"+e,document.body.appendChild(t),t},s.renderWrapper=function(e){var t=document.createElement("DIV");return t.className="modal-wrapper modal-wrapper_invisible",t.classList.add("modal-wrapper_"+e),t.id="modal-wrapper-"+e,document.body.appendChild(t),t},s.prototype.renderWindow=function(e){var t=document.createElement("DIV");t.innerHTML=e;var r=t.firstElementChild;return this.status===s.statuses.MINOR?s.minorWrapper.appendChild(r):s.majorWrapper.appendChild(r),t.remove(),r},s.prototype.show=function(){this.status===s.statuses.MINOR?(s.minorBackdrop||s.setBackdrop(s.statuses.MINOR),s.minorWrapper||s.setWrapper(s.statuses.MINOR),s.minorWrapper.classList.remove("modal-wrapper_invisible"),s.minorBackdrop.classList.remove("backdrop_invisible")):(s.majorBackdrop||s.setBackdrop(s.statuses.MAJOR),s.majorWrapper||s.setWrapper(s.statuses.MAJOR),s.majorWrapper.classList.remove("modal-wrapper_invisible"),s.majorBackdrop.classList.remove("backdrop_invisible")),this.active=!0},s.prototype.activate=function(e){var t=this;return"spinner"===this.elemId&&!function(){var e=t;t.on("spinner_host-loaded",function(r){var i=r.detail.host;t.status===s.statuses.MINOR?s.minorQueue.splice(s.minorQueue.indexOf(e)+1,0,i):s.majorQueue.splice(s.majorQueue.indexOf(e)+1,0,i),e.deactivate(r.detail.options)})}(),new Promise(function(r,i){t.status===s.statuses.MINOR?(s.minorQueue.push(t),s.minorActive?r():s.minorShow(e).then(function(){r()})):(s.majorQueue.push(t),s.majorActive?r():s.majorShow(e).then(function(){r()}))})},s.prototype.hide=function(){this.status===s.statuses.MINOR?(s.minorWrapper.classList.add("modal-wrapper_invisible"),s.minorBackdrop.classList.add("backdrop_invisible")):(s.majorWrapper.classList.add("modal-wrapper_invisible"),s.majorBackdrop.classList.add("backdrop_invisible"))},s.prototype.deactivate=function(e,t){this.hide(t),this.active=!1,this.status===s.statuses.MINOR?(s.minorActive=!1,s.minorQueue.shift(),s.minorShow(e)):(s.majorActive=!1,s.majorQueue.shift(),s.majorShow(e)),this.trigger("modal-window_deactivated")},s.minorActive=!1,s.majorActive=!1,s.minorQueue=[],s.majorQueue=[],s.spinner=new o,s.spinner.status=s.statuses.MAJOR,s.showSpinner=function(){s.prototype.show.call(s.spinner),s.spinner.elem||(s.spinner.elem=document.getElementById("spinner")),s.spinner.elem||(s.spinner.elem=s.prototype.renderWindow.call(s.spinner,o.html)),s.spinner.show()},s.hideSpinner=function(){s.spinner.hide()},s.minorShow=function(e){var t=s.minorQueue[0];if(t){var r=t.show(e);return r?r.then(function(){s.minorActive=!0}):(s.minorActive=!0,Promise.resolve())}return s.minorActive=!1,Promise.resolve()},s.majorShow=function(e){var t=s.majorQueue[0];if(t){s.showSpinner();var r=t.show(e);return r?r.then(function(){s.majorActive=!0,s.hideSpinner()}):(s.majorActive=!0,s.hideSpinner(),Promise.resolve())}return s.majorActive=!1,Promise.resolve()};for(var n in i)s.prototype[n]=i[n];e.exports=s},function(e,t){"use strict";e.exports={on:function(e,t){this.elem?this.elem.addEventListener(e,t):this.listeners.push({eventName:e,cb:t})},trigger:function(e,t){this.elem.dispatchEvent(new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:t}))},error:function(e){this.elem.dispatchEvent(new CustomEvent("error",{bubbles:!0,cancelable:!0,detail:e}))}}},function(e,t,r){"use strict";var i=function(e){this.elem=document.getElementById("spinner")};i.html=r(20),i.prototype.show=function(){this.elem.classList.remove("spinner_invisible")},i.prototype.hide=function(){this.elem.classList.add("spinner_invisible")},e.exports=i},function(e,t){e.exports="<div id=spinner class=spinner> </div>"},,,,,function(e,t,r){"use strict";var i=r(15).ServerError,o=r(15).ClientError;e.exports=function(e,t,r,s){var n="";if("string"!=typeof e)for(var a in e){var l="";e[a]&&(l=a+"="+encodeURIComponent("object"==typeof e[a]?JSON.stringify(e[a]):e[a])),l&&(n+=(""===n?"":"&")+l)}else n=e;var c=new XMLHttpRequest;c.open(t,r,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.onreadystatechange=function(){if(4==this.readyState){var e=void 0;if(!this.responseText)return void s(new i("Server is not responding"));e=JSON.parse(this.responseText),this.status>=200&&this.status<300&&s(null,e),this.status>=400&&this.status<500&&s(new o(e.message,e.detail,this.status)),this.status>=500&&s(new i(e.message,this.status))}},c.send(n)}},,,,,function(e,t,r){"use strict";var i=r(18),o=r(15).ClientError,s=r(15).ImageNotFound,n=r(17),a=r(31),l=function(e){var t=this;n.apply(this,arguments),this.status=n.statuses.MAJOR,this.gallery=e.gallery,this.elem=e.elem,this.isLogged=e.isLogged,this.preloadEntityCount=e.preloadEntityCount,this.isFeed=e.isFeed||!1,this.userSubscribeButton=e.userSubscribeButton,this.viewModels={},this.galleryArray=null,this.currentImageId=null,this.loggedUserViewModel=null,this.isEmbedded=!!this.gallery,this.preloadedImages={},Object.defineProperty(this,"currentViewModel",{get:function(){return t.viewModels[t.currentImageId]}});for(var r=1;r<=this.preloadEntityCount;r++)this.preloadedImages[r]=new Image,this.preloadedImages[-r]=new Image;window.addEventListener("popstate",function(e){t.onPopState(e.state)},!1),window.addEventListener("resize",function(e){t.onResize()}),this.pushGalleryState(),this.isEmbedded?this.setGallery(e):this.show(+this.elem.dataset.id).catch(function(e){t.error(e)})};l.prototype=Object.create(n.prototype),l.prototype.constructor=l,l.prototype.onResize=function(){this.commentSection&&this.commentSection.update()},l.prototype.onGalleryClick=function(e){var t=void 0;if(t=e.target.closest(".image-preview")){e.preventDefault();var r=+t.dataset.id;return this.activate({imageId:r})}},l.prototype.setGallery=function(e){var t=this;this.publicationNumberElem=e.publicationNumberElem,this.imagePreviewGhost=this.gallery.querySelector(".image-preview"),this.galleryWrapper=this.gallery.querySelector(".gallery__wrapper"),this.gallery.onclick=function(e){t.onGalleryClick(e)}},l.prototype.setElem=function(){var e=this;return new Promise(function(t,i){e.isElemSetted=!0,e.elem||(e.elem=e.renderWindow(r(32))),e.imgElem=e.elem.querySelector("img.image__img-element"),e.description=e.elem.querySelector(".image__description"),e.date=e.elem.querySelector(".image__post-date"),e.imageWrapper=e.elem.querySelector(".image__image-wrapper"),e.sideBar=e.elem.querySelector(".image__sidebar"),e.deleteButtonElem=e.elem.querySelector(".image__delete-button"),e.subscribeButtonElem=e.elem.querySelector(".image__subscribe-button"),e.avatar=e.elem.querySelector(".image__avatar"),e.username=e.elem.querySelector(".image__username"),e.headerLeftSide=e.elem.querySelector(".image__header-left-side"),e.fullscreenButton=e.elem.querySelector(".image__control-full"),e.imgElem.onload=function(t){e.resizeImage(),e.showImgElem()},e.elem.onclick=function(t){e.onElemClick(t),t.target.matches(".image__modal-close-button-wrapper")&&e.deactivate(),t.target.matches(".image__control-prev")&&e.switchToPrev(),t.target.matches(".image__control-next")&&e.switchToNext(),t.target===e.fullscreenButton&&e.switchFullscreen(),(t.target.matches(".image__close-space")||t.target.matches(".image__close-button"))&&e.deactivate()};var s=r(33),n=r(35);e.commentSection=new s({elem:e.elem.querySelector(".comment-section"),commentSenderElem:e.elem.querySelector(".comment-send"),imageId:e.currentImageId,loggedUserViewModel:e.loggedUserViewModel,commentSectionWrapper:e.elem.querySelector(".image__comment-section-wrapper"),infoBoard:e.elem.querySelector(".image__info-board"),scrollbarWrapper:e.elem.querySelector(".image__comment-section-scrollbar-wrapper")}),e.commentSection.on("comment-section_changed",function(t){var r=t.detail.imageId;e.deleteViewModel(r),e.requestViewModel(r).then(function(){e.updateComments(r)})}),e.likeButton=new n({elem:e.elem.querySelector(".like-button"),data:e.currentImageId}),e.likeButton.on("switch-button_changed",function(t){var r=t.detail.imageId;e.deleteViewModel(r),e.requestViewModel(r).then(function(){e.updateLikes(r)})}),e.onResize(),e.isLogged?e.currentViewModel.isOwnImage?(e.setDeleteButton(),r.e(4,function(i){var o=r(36);e.deleteButton=new o({elem:e.deleteButtonElem,imageId:e.currentImageId}),e.deleteButton.on("delete-image-button_image-deleted",function(t){var r=t.detail.imageId;e.deleteViewModel(r),e.removeFromGalleryArray(r),e.deleteImagePreview(r),e.currentImageId===r&&e.switchToNext()}),t()})):r.e(5,function(i){var o=r(39);e.subscribeButton=new o({elem:e.subscribeButtonElem,data:e.currentImageId}),e.userSubscribeButton&&a.setRelation(e.subscribeButton,e.userSubscribeButton),e.subscribeButton.on("switch-button_changed",function(t){var r=t.detail.imageId;e.isFeed&&r===e.currentImageId&&(e.viewModels={})}),e.setSubscribeButton(),e.subscribeButton.set({active:e.currentViewModel.author.isNarrator}),t()}):(e.subscribeButtonElem.onclick=function(t){e.error(new o(null,null,401))},t())})},l.prototype.switchFullscreen=function(){function e(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullscreen&&e.mozRequestFullscreen()}function t(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozExitFullscreen&&document.mozExitFullscreen()}this.isFullscreen?(t(),this.isFullscreen=!1,this.fullscreenButton.classList.add("icon-arrow-maximise"),this.fullscreenButton.classList.remove("icon-arrow-minimise")):(e(this.imageWrapper),this.isFullscreen=!0,this.fullscreenButton.classList.remove("icon-arrow-maximise"),this.fullscreenButton.classList.add("icon-arrow-minimise"))},l.prototype.setDeleteButton=function(){this.deleteButtonElem.classList.remove("button_invisible"),this.subscribeButtonElem.classList.add("button_invisible")},l.prototype.setSubscribeButton=function(){this.subscribeButtonElem.classList.remove("button_invisible"),this.deleteButtonElem.classList.add("button_invisible")},l.prototype.updatePreloadedImagesArray=function(){for(var e=1;e<=this.preloadEntityCount;e++){var t=this.getNextImageId(e),r=this.getNextImageId(-e);this.viewModels[t]&&this.preloadedImages[e].setAttribute("src",this.viewModels[t].imgUrl),this.viewModels[r]&&this.preloadedImages[-e].setAttribute("src",this.viewModels[r].imgUrl)}},l.prototype.show=function(e){var t=this,r=void 0,i=void 0;return 1===arguments.length&&"number"==typeof arguments[0]?r=arguments[0]:(r=e&&e.imageId,i=e&&e.noPushState||!1),new Promise(function(e,o){t.isEmbedded&&n.prototype.show.apply(t),t.requestViewModel(r).then(function(){t.currentImageId=r,t.isElemSetted?(t.updateCurrentView(r),t.elem.classList.remove("image_invisible"),i||r!==t.currentImageId||t.pushImageState(),e(),t.requestAllNecessaryViewModels().then(function(){t.updatePreloadedImagesArray()})):t.setElem().then(function(){t.updateCurrentView(r),t.elem.classList.remove("image_invisible"),i||r!==t.currentImageId||t.pushImageState(),e(),t.requestAllNecessaryViewModels().then(function(){t.updatePreloadedImagesArray()})})}).catch(function(e){o(e)})})},l.prototype.hide=function(e){var t=e&&e.noPushState;this.isEmbedded?(n.prototype.hide.apply(this),this.elem.classList.add("image_invisible"),t||this.pushGalleryState()):window.location=this.elem.dataset.authorUrl},l.prototype.hideImgElem=function(){this.elem.classList.add("image_img-element-invisible")},l.prototype.showImgElem=function(){this.elem.classList.remove("image_img-element-invisible")},l.prototype.resizeImage=function(){},l.prototype.requestViewModel=function(e){var t=this;return new Promise(function(i,n){if(t.viewModels[e])return void i();var a={id:e,isFeed:t.isFeed};t.isLogged&&!t.loggedUserViewModel&&(a.requireUserViewModel=!0),r(25)(a,"POST","/gallery",function(r,a){if(r)return r instanceof o?(t.galleryArray&&(t.removeFromGalleryArray(e),t.updateGallery()),n(new s)):t.error(r);t.galleryArray=a.gallery,t.updateGallery(),t.isLogged&&!t.loggedUserViewModel&&a.loggedUserViewModel&&(t.loggedUserViewModel=a.loggedUserViewModel);var l=!1;for(var c in a.viewModels)c==e&&(l=!0),t.viewModels[c]=a.viewModels[c];l?i(a):(t.galleryArray&&(t.removeFromGalleryArray(e),t.updateGallery()),n(new s))})})},l.prototype.removeFromGalleryArray=function(e){this.galleryArray&&~this.galleryArray.indexOf(e)&&this.galleryArray.splice(this.galleryArray.indexOf(e),1)},l.prototype.addToGalleryArray=function(e){this.galleryArray&&this.galleryArray.push(e)},l.prototype.updateGallery=function(){if(this.galleryArray&&this.gallery){for(var e=this.gallery.querySelectorAll(".image-preview"),t=0;t<e.length;t++)~this.galleryArray.indexOf(+e[t].dataset.id)||e[t].remove();this.setPublicationNumber(this.galleryArray.length)}},l.prototype.getImagePreviewById=function(e){return this.gallery.querySelector('.image-preview[data-id="'+e+'"]')},l.prototype.updateImagePreviewText=function(e){var t=this.viewModels[e].likes.length,r=this.viewModels[e].comments.length,i=this.getImagePreviewById(e);i.dataset.likeAmount=t,i.dataset.commentAmount=r,i.querySelector(".image-preview__comment-number").textContent=r,i.querySelector(".image-preview__like-number").textContent=t},l.prototype.deleteImagePreview=function(e){var t=this.getImagePreviewById(e);t&&(t.remove(),this.setPublicationNumber(-1,!0))},l.prototype.insertNewImagePreview=function(e,t){var r=this.imagePreviewGhost.cloneNode(!0);r.classList.remove("image-preview_ghost"),r.dataset.id=e,r.href="/image/"+e,r.querySelector(".image-preview__picture").style.backgroundImage="url('/"+t+"')",previewImageElem.querySelector(".image-preview__comment-number").textContent=0,previewImageElem.querySelector(".image-preview__like-number").textContent=0,this.galleryWrapper.appendChild(r),this.setPublicationNumber(1,!0),this.addToGalleryArray(e)},l.prototype.setPublicationNumber=function(e,t){this.publicationNumberElem&&(t?this.publicationNumberElem.textContent=+this.publicationNumberElem.textContent+e:this.publicationNumberElem.textContent=e)},l.prototype.deleteViewModel=function(e){delete this.viewModels[e]},l.prototype.requestAllNecessaryViewModels=function(){return Promise.all([this.requestNextViewModels(),this.requestPrevViewModels()])},l.prototype.requestNextViewModels=function(){if(this.galleryArray&&0===this.galleryArray.length)return Promise.reject(new s);for(var e=[],t=0;t<this.preloadEntityCount;t++)e.push(this.requestViewModel(this.getNextImageId(t)));return Promise.all(e)},l.prototype.requestPrevViewModels=function(){if(this.galleryArray&&0===this.galleryArray.length)return Promise.reject(new s);for(var e=[],t=0;t<this.preloadEntityCount;t++)e.push(this.requestViewModel(this.getPrevImageId(t)));return Promise.all(e)},l.prototype.switchToNext=function(){var e=this;if(this.galleryArray&&!this.galleryArray.length)return void this.deactivate();var t=this.getNextImageId();this.show(t).catch(function(t){t instanceof s?e.galleryArray&&e.galleryArray.length?e.switchToNext():e.deactivate():e.error(t)})},l.prototype.switchToPrev=function(){var e=this;if(this.galleryArray&&!this.galleryArray.length)return void this.deactivate();var t=this.getPrevImageId();this.show(t).catch(function(t){t instanceof s?e.galleryArray&&e.galleryArray.length?e.switchToPrev():e.deactivate():e.error(t)})},l.prototype.getNextImageId=function(e){e=e||1;var t=this.galleryArray.indexOf(this.currentImageId);return this.galleryArray[(t+e)%this.galleryArray.length]},l.prototype.getPrevImageId=function(e){e=e||1;var t=this.galleryArray.indexOf(this.currentImageId);if(~t&&1===this.galleryArray.length)return this.galleryArray[0];var r=t-e;return r<0&&(r%=this.galleryArray.length,r=this.galleryArray.length+r),this.galleryArray[r]},l.prototype.updateCurrentView=function(e){e===this.currentImageId&&(this.hideImgElem(),this.imgElem.setAttribute("src",this.currentViewModel.imgUrl),this.likeButton.setImageId(this.currentImageId),this.updateLikes(this.currentImageId),this.commentSection.setImageId(this.currentImageId),this.updateComments(this.currentImageId),this.description.textContent=this.currentViewModel.description,""===this.description.textContent?this.elem.classList.add("image_no-description"):this.elem.classList.remove("image_no-description"),this.date.textContent=this.currentViewModel.createDateStr,this.isLogged&&(this.currentViewModel.isOwnImage?this.deleteButton.setImageId(this.currentImageId):this.subscribeButton.setImageId(this.currentImageId)),this.isFeed&&this.subscribeButton.set({active:!0}),this.avatar.style.backgroundImage="url('"+this.currentViewModel.author.avatarUrls.medium+"')",this.username.textContent=this.currentViewModel.author.username,this.headerLeftSide.setAttribute("href",this.currentViewModel.author.url))},l.prototype.updateLikes=function(e){this.currentImageId===e&&this.likeButton.set({active:this.currentViewModel.isLiked,likeAmount:this.currentViewModel.likes.length}),this.gallery&&this.updateImagePreviewText(e)},l.prototype.updateComments=function(e){this.currentImageId===e&&this.commentSection.set(this.currentViewModel.comments),this.gallery&&this.updateImagePreviewText(e)},l.prototype.pushImageState=function(){history.pushState({type:"image",id:this.currentImageId},"image #"+this.currentImageId,"/image/"+this.currentImageId)},l.prototype.pushGalleryState=function(){var e="";e=this.isFeed?"/feed":this.currentViewModel&&this.currentViewModel.author.url,history.pushState({type:"gallery"},"",e)},l.prototype.onPopState=function(e){if(e&&e.type)switch(e.type){case"image":this.show({imageId:e.id,noPushState:!0});break;case"gallery":this.deactivate(null,{noPushState:!0})}};for(var c in i)l.prototype[c]=i[c];e.exports=l},function(e,t,r){"use strict";function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var o=r(18),s=function e(t){var r=this;this.elem=t.elem,this.data=t.data,this.dataStr=t.dataStr||"imageId",e.prototype.set.call(this,{active:!!this.elem.dataset.active}),this.available=!0,this.elem.onclick=function(e){return r.onClick(e)}};s.prototype.onClick=function(e){var t=this,o=this.data;this.available&&(this.available=!1,this.toggle(),r(25)(i({},this.dataStr,o),"POST",this.url,function(e,r){if(e)t.error(e),t.data===o&&(t.available=!0,t.toggle());else{var s;t.set(r),t.available=!0,t.trigger("switch-button_changed",(s={},i(s,t.dataStr,o),i(s,"response",r),s))}}))},s.setRelation=function(e,t){e.on("switch-button_changed",function(e){t.set(e.detail.response)}),t.on("switch-button_changed",function(t){e.set(t.detail.response)})},s.prototype.set=function(e){e.active?this._activate():this._deactivate()},s.prototype.toggle=function(){this.active?this.set({active:!1}):this.set({active:!0})},s.prototype._activate=function(){this.elem.classList.add("button_active"),this.active=!0},s.prototype._deactivate=function(){this.elem.classList.remove("button_active"),this.active=!1},s.prototype.setImageId=function(e){this.data=e};for(var n in o)s.prototype[n]=o[n];e.exports=s},function(e,t){e.exports='<div id=image class="modal image image_no-description"> <div class=image__image-wrapper> <img class=image__img-element> <div class=image__controls> <div class="image__control image__control-prev icon-arrow-left"></div> <div class="image__control image__control-full icon-arrow-maximise"></div> <div class="image__control image__control-next icon-arrow-right"></div> </div> </div> <div class=image__sidebar> <div class=image__top-side> <div class="header image__header"> <a class=image__header-left-side href=""> <div class=image__avatar style="background-image:url(\'\')"></div> <div class=image__metadata> <div class=image__username></div> <div class=image__post-date></div> </div> </a> <div class="button button_invisible image__top-side-button image__delete-button button_header-style"> delete </div> <div class="button image__top-side-button image__subscribe-button button_header-style"> subscribe </div> </div> <div class=image__info-board> <div class="button like-button image__like-button"> like </div> <div class=image__description> </div> </div> <div class="image__comment-section-wrapper image_no-scrollbar"> <div class="comment-section image__comment-section"> <div class=comment-section__comments-wrapper> <div class="panel comment comment-section__comment comment_ghost" data-id=""> <div class=comment__top-side> <a class=comment__ref href=""> <div class=comment__avatar style="background-image:url(\'\')"></div> <div class=comment__metadata> <div class=comment__username></div> <div class=comment__date></div> </div> </a> <div class="comment__close-button icon-cross"></div> </div> <div class=comment__text></div> </div> </div> </div> </div> <div class="image__comment-section-scrollbar-wrapper image_no-scrollbar"> <div class=image__comment-section-scrollbar-offset></div> <div class=image__comment-section-scrollbar> <div class=image__comment-section-slider></div> </div> </div> </div> <div class="panel comment comment-send image__comment-send" data-image-id=""> <div class=comment__top-side> <div class=comment__avatar style="background-image:url(\'\')"></div> <div class=comment__username>anonym</div> </div> <textarea placeholder="share your opinionâ€¦" class=comment-send__textarea></textarea> <div class="button comment-send__send-button">send</div> </div> </div> <div class=image__modal-close-button-wrapper> <div class="icon-cross modal-close-button image__modal-close-button"></div> </div> </div> '},function(e,t,r){"use strict";var i=r(34),o=function(e){function t(e){var t=e.getBoundingClientRect();return{top:t.top+pageYOffset,left:t.left+pageXOffset}}var r=this;i.apply(this,arguments),this.commentSectionWrapper=e.commentSectionWrapper,this.infoBoard=e.infoBoard,this.scrollbarWrapper=e.scrollbarWrapper,this.scrollbar=this.scrollbarWrapper.querySelector(".image__comment-section-scrollbar"),this.scrollbarOffset=this.scrollbarWrapper.querySelector(".image__comment-section-scrollbar-offset"),this.scrollbarSlider=this.scrollbarWrapper.querySelector(".image__comment-section-slider"),this.commentSectionWrapper.onscroll=function(e){r.onDragging||r.setTop()},this.scrollbarSlider.onmousedown=function(e){r.onDragging=!0;var i=t(r.scrollbarSlider),o=e.pageY-i.top,s=t(r.scrollbar),n=void 0;return document.onmousemove=function(e){n=e.pageY-o-s.top,n<0&&(n=0);var t=r.scrollbar.offsetHeight-r.scrollbarSlider.offsetHeight;n>t&&(n=t),r.scrollbarSlider.style.top=n+"px",r.commentSectionWrapper.scrollTop=n/r.scrollbar.offsetHeight/(1-r.sliderSizeRate)*(r.commentSectionWrapper.scrollHeight-r.commentSectionWrapper.offsetHeight)},document.onmouseup=function(e){r.scrollbarSlider.style.top=100*n/r.scrollbar.offsetHeight+"%",r.onDragging=!1,document.onmousemove=document.onmouseup=null},!1},this.scrollbarSlider.ondragstart=function(){return!1}};o.prototype=Object.create(i.prototype),o.prototype.constructor=o,o.prototype.set=function(){i.prototype.set.apply(this,arguments),this.update()},o.prototype.setTop=function(){var e=this.commentSectionWrapper.scrollTop/(this.commentSectionWrapper.scrollHeight-this.commentSectionWrapper.offsetHeight)*100;this.scrollbarSlider.style.top=(1-this.sliderSizeRate)*e+"%"},o.prototype.update=function(){this.commentSectionWrapper.classList.add("image_no-scrollbar"),this.scrollbarWrapper.classList.add("image_no-scrollbar"),this.infoBoardHeight=this.infoBoard.offsetHeight;var e=getComputedStyle(this.infoBoard);parseFloat(e.height)&&(this.infoBoardHeight=parseFloat(e.height)),this.scrollbarOffset.style.height=this.infoBoardHeight+"px",this.scrollbar.style.height="calc(100% - "+this.infoBoardHeight+"px)",this.commentSectionWrapper.offsetHeight-this.commentsWrapper.scrollHeight<-1&&(this.sliderSizeRate=this.commentSectionWrapper.offsetHeight/this.commentsWrapper.scrollHeight,this.scrollbarSlider.style.height=100*this.sliderSizeRate+"%",this.setTop(),this.commentSectionWrapper.classList.remove("image_no-scrollbar"),this.scrollbarWrapper.classList.remove("image_no-scrollbar"))},e.exports=o},function(e,t,r){"use strict";var i=r(18),o=function(e){var t=this;this.elem=e.elem,this.commentsWrapper=e.elem.querySelector(".comment-section__comments-wrapper"),this.imageId=e.imageId,this.loggedUserViewModel=e.loggedUserViewModel,this.commentSenderElem=e.commentSenderElem,this.commentSendTextarea=this.commentSenderElem.querySelector(".comment-send__textarea"),this.ghost=this.commentsWrapper.querySelector(".comment"),this.loggedUserViewModel&&(this.commentSenderElem.querySelector(".comment__avatar").style.backgroundImage="url('"+this.loggedUserViewModel.avatarUrls.medium+"')",this.commentSenderElem.querySelector(".comment__username").textContent=this.loggedUserViewModel.username),this.commentSenderElem.onclick=function(e){if(e.target.classList.contains("comment-send__send-button")){var i=t.imageId,o=t.commentSendTextarea.value;o.length&&r(25)({id:i,text:o},"POST","/comment",function(e,r){return e?void t.error(e):(t.commentSendTextarea.value="",t.imageId===i&&(t.insertNewComment(r.viewModel),t.scrollToBottom()),void t.trigger("comment-section_changed",{imageId:i}))})}},this.elem.onclick=function(e){if(e.target.classList.contains("comment__close-button")){var i=e.target.closest(".comment"),o=i.dataset.id,s=t.imageId;r(25)({id:o},"DELETE","/comment",function(e,r){return e?void t.error(e):(t.trigger("comment-section_changed",{imageId:s}),void i.remove())})}}};o.prototype.scrollToBottom=function(){this.commentsWrapper.scrollTop=this.commentsWrapper.scrollHeight},o.prototype.insertNewComment=function(e){var t=this.ghost.cloneNode(!0);t.classList.remove("comment_ghost"),t.dataset.id=e._id,t.querySelector(".comment__ref").setAttribute("href",e.commentator.url),t.querySelector(".comment__avatar").style.backgroundImage="url('"+e.commentator.avatarUrls.medium+"')",t.querySelector(".comment__username").textContent=e.commentator.username,t.querySelector(".comment__date").textContent=e.createDateStr,e.isOwnComment?t.classList.remove("comment_not-own"):t.classList.add("comment_not-own"),t.querySelector(".comment__text").textContent=e.text,this.commentsWrapper.appendChild(t)},o.prototype.setImageId=function(e){this.imageId=e},o.prototype.set=function(e){var t=this;this.clear(),e.forEach(function(e){t.insertNewComment(e)})},o.prototype.clear=function(){this.commentsWrapper.innerHTML=""};for(var s in i)o.prototype[s]=i[s];e.exports=o},function(e,t,r){"use strict";var i=r(31),o=function(e){i.apply(this,arguments),this.likeAmount=+this.elem.dataset.likeAmount,this.url="/like"};o.prototype=Object.create(i.prototype),o.prototype.constructor=o,o.prototype.setAmount=function(e){this.likeAmount=e,this.elem.textContent="like "+this.likeAmount},o.prototype.set=function(e){this.setAmount(e.likeAmount),i.prototype.set.call(this,e)},o.prototype.toggle=function(){this.active?this.set({active:!1,likeAmount:this.likeAmount-1}):this.set({active:!0,likeAmount:this.likeAmount+1})},e.exports=o},,,,,,,function(e,t){}]);